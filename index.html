<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>訂單計算機</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .item {
            margin-bottom: 10px;
        }

        .item label {
            display: inline-block;
            width: 250px;
        }

        #totalOutput {
            font-size: 24px;
            font-weight: bold;
            margin-top: 20px;
        }

        .info-field {
            margin-bottom: 15px;
        }

        .info-field label {
            display: inline-block;
            width: 80px;
            font-weight: bold;
        }

        .discount-text {
            color: red;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <h1>麻老六滷味訂單-測試</h1>
    <img src="images/logo.png" alt="" style="max-width:20%; height:auto;">
    <fieldset>
        <legend>訂單資訊</legend>
        <div class="info-field">
            <label for="orderer">訂購人：</label>
            <input type="text" id="orderer">
        </div>
        <div class="info-field">
            <label for="phone">電話：</label>
            <input type="tel" id="phone">
        </div>
        <div class="info-field">
            <label for="leader">團長：</label>
            <input type="text" id="leader">
        </div>
    </fieldset>

    <hr>

    <div id="menu">
        <h3> 份量依照訂購單為主，此工具主要用來方便統計及確認。</h3>
        <div class="item">
            <label>鴨頭 (100元/份, 多份另有優惠)</label>
            <input type="number" data-price="100" value="0" min="0">
        </div>
        <div class="item">
            <label>鴨翅 (175元/份)</label>
            <input type="number" data-price="175" value="0" min="0">
        </div>
        <div class="item">
            <label>鴨舌 (130元/份)</label>
            <input type="number" data-price="130" value="0" min="0">
        </div>
        <div class="item">
            <label>雞腳 (70元/份)</label>
            <input type="number" data-price="70" value="0" min="0">
        </div>
        <div class="item">
            <label>雞架 (80元/份)</label>
            <input type="number" data-price="80" value="0" min="0">
        </div>
        <div class="item">
            <label>鴨脖 (80元/份)</label>
            <input type="number" data-price="80" value="0" min="0">
        </div>
        <div class="item">
            <label>雞心 (80元/份)</label>
            <input type="number" data-price="80" value="0" min="0">
        </div>
        <div class="item">
            <label>雞胗 (80元/份)</label>
            <input type="number" data-price="80" value="0" min="0">
        </div>
        <div class="item">
            <label>鴨腱頭 (80元/份)</label>
            <input type="number" data-price="80" value="0" min="0">
        </div>
        <div class="item">
            <label>烏蛋 (80元/份)</label>
            <input type="number" data-price="80" value="0" min="0">
        </div>
        <div class="item">
            <label>蓮藕 (100元/份)</label>
            <input type="number" data-price="100" value="0" min="0">
        </div>
        <div class="item">
            <label>豆干 (50元/份)</label>
            <input type="number" data-price="50" value="0" min="0">
        </div>
        <div class="item">
            <label>百頁豆腐 (50元/份)</label>
            <input type="number" data-price="50" value="0" min="0">
        </div>
        <div class="item">
            <label>海帶 (50元/份)</label>
            <input type="number" data-price="50" value="0" min="0">
        </div>
        <div class="item">
            <label>米血 (60元/份)</label>
            <input type="number" data-price="60" value="0" min="0">
        </div>
        <div class="item">
            <label>甜不辣 (60元/份)</label>
            <input type="number" data-price="60" value="0" min="0">
        </div>
        <div class="item">
            <label>香菇 (70元/份)</label>
            <input type="number" data-price="70" value="0" min="0">
        </div>
        <div class="item">
            <label>芋粿 (70元/份)</label>
            <input type="number" data-price="70" value="0" min="0">
        </div>
        <div class="item">
            <label>A組合（海帶+百頁豆腐+香菇）(80元/份)</label>
            <input type="number" data-price="80" value="0" min="0">
        </div>
        <div class="item">
            <label>B組合（芋粿+米血+甜不辣）(80元/份)</label>
            <input type="number" data-price="80" value="0" min="0">
        </div>
        
        <hr>
        <h3> 9/10 前預購享有優惠價格 </h3>
        <div class="item" data-combo-item="true">
            <label>超值豪華組合 (850元/份)</label>
            <input type="number" data-price="850" value="0" min="0" id="luxuryCombo">
        </div>
        <div class="item" data-combo-item="true">
            <label>精選旗艦組合 (600元/份)</label>
            <input type="number" data-price="600" value="0" min="0" id="flagshipCombo">
        </div>
    </div>

    <hr>

    <button onclick="calculateTotal()">計算總金額</button>

    <div id="results">
        <h3>訂單明細：</h3>
        <p id="outputDetails"></p>
    </div>

    <script>
        function calculateTotal() {
            // 抓取訂單資訊
            const orderer = document.getElementById("orderer").value;
            const phone = document.getElementById("phone").value;
            const leader = document.getElementById("leader").value;

            // 抓取品項並計算總價
            const items = document.querySelectorAll('#menu .item input');
            let total = 0;
            let details = '';
            let comboDetails = '';
            let comboTotal = 0;
            let detailsCount = 1;
            let comboCount = 1;

            // 抓取兩個新組合的數量
            const luxuryComboQuantity = parseInt(document.getElementById("luxuryCombo").value);
            const flagshipComboQuantity = parseInt(document.getElementById("flagshipCombo").value);
            const totalComboQuantity = luxuryComboQuantity + flagshipComboQuantity;

            // 獲取並格式化當前時間
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const nowFormatted = `${year}/${month}/${day} ${hours}:${minutes}:${seconds}`;

            // 設定促銷活動截止日期
            const promotionEndDate = new Date('2025-09-10T23:59:59');

            items.forEach(item => {
                const quantity = parseInt(item.value);
                const price = parseInt(item.getAttribute('data-price'));
                const itemName = item.previousElementSibling.textContent.split('(')[0].trim();
                
                if (quantity > 0) {
                    // 判斷是否為組合商品
                    if (itemName.includes('超值豪華組合') || itemName.includes('精選旗艦組合')) {
                        let finalPrice = price; // 預設為原價
                        let discountMessage = '';
                        if (now < promotionEndDate) {
                            if (itemName.includes('超值豪華組合')) {
                                if (luxuryComboQuantity >= 10) {
                                    finalPrice = 725;
                                    discountMessage = '預購十組以上優惠價 85 折';
                                } else {
                                    finalPrice = 765;
                                    discountMessage = '預購優惠價 9 折';
                                }
                            } else if (itemName.includes('精選旗艦組合')) {
                                if (flagshipComboQuantity >= 10) {
                                    finalPrice = 510;
                                    discountMessage = '預購十組以上優惠價 85 折';
                                } else {
                                    finalPrice = 540;
                                    discountMessage = '預購優惠價 9 折';
                                }
                            }
                        }
                        
                        comboTotal += quantity * finalPrice;
                        comboDetails += `${comboCount}. ${itemName} (${discountMessage} ${finalPrice} 元) * ${quantity} = ${quantity * finalPrice} 元<br>`;
                        comboCount++;
                    }  else if (itemName.includes('鴨頭')) {
                        let finalPrice;
                        let displayPrice;
                        if (quantity % 2 !== 0) { // 奇數
                            finalPrice = 100 + ((quantity - 1) / 2) * 175;
                            displayPrice = finalPrice;
                        } else { // 偶數
                            finalPrice = (quantity / 2) * 175;
                            displayPrice = finalPrice;
                        }

                        if (quantity == 1) {
                            details += `${detailsCount}. ${itemName} * ${quantity} = ${quantity * price} 元<br>`;
                        } else {
                            details += `${detailsCount}. ${itemName} (原價 1 份 100 元) * ${quantity} = (優惠價組合價) ${displayPrice} 元<br>`;
                        }
                        total += finalPrice;
                        detailsCount++;
                    } else {
                        total += quantity * price;
                        details += `${detailsCount}. ${itemName} * ${quantity} = ${quantity * price} 元<br>`;
                        detailsCount++;
                    }
                }
            });

            // 將所有資訊組合在一起
            let fullOutput = `
                請利用螢幕截圖, 截取"訂購資訊"<br>
                -------------------------------------------<br>
                <strong>訂購資訊</strong><br>
                訂購人：${orderer}<br>
                電話：${phone}<br>
                團長：${leader}<br>
                -------------------------------------------<br>
                訂單時間：${nowFormatted}<br>
                -------------------------------------------<br>
                <strong>單點訂單明細</strong><br>
                ${details}
                <span class="discount-text">單點總金額：${total} 元</span>
            `;
            
            // 如果有組合商品，加上分隔線和組合明細
            if (comboDetails !== '') {
                fullOutput += `
                    <br>
                    -------------------------------------------<br>
                    <strong>優惠組合訂單明細</strong><br>
                    ${comboDetails}
                    <br>
                    <span class="discount-text">組合總金額：${comboTotal} 元</span>
                `;
                total += comboTotal;
            }

            fullOutput += `
                <br>
                <span style="font-size: 36px; font-weight: bold;">總金額：${total} 元</span>
            `;

            // 輸出結果到同一個區塊
            document.getElementById('outputDetails').innerHTML = fullOutput;
        }
    </script>

</body>

</html>